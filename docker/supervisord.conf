[supervisord]
nodaemon=true
user=root
logfile=/dev/fd/1
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid

[program:php-fpm]
priority=10
command=php-fpm -F
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0

[program:nginx]
priority=20
; Wait until php-fpm is actually listening to avoid 502s on cold start
command=/bin/sh -lc 'until nc -z 127.0.0.1 9000; do echo "waiting for php-fpm on 127.0.0.1:9000..."; sleep 0.2; done; exec /usr/sbin/nginx -g "daemon off;"'
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
